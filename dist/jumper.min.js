/* QOX Corporation
 Jumper.js
 https://github.com/QOXCorp/jumper.js
 0.0.0.3
 (C) 2015 - Giancarlo Chiappe Aguilar <gchiappe@qox-corp.com>
 */
var Jumper=function(options){if(console.log("Initilizing QOX Jumper."),"undefined"==typeof options&&console.error("QOX Jumper options not stablished."),Jumper.Options.bindFnKeys="undefined"==typeof options.bindFnKeys?Jumper.KeysControl:options.bindFnKeys,"undefined"==typeof options.bindLetter&&(options.bindLetter="J"),"undefined"!=typeof options.cache&&(Jumper.Cache=options.cache),"undefined"!=typeof options.data?Jumper.Options.data=options.data:"undefined"==typeof options.ajax?console.error("QOX Jumper: No data source defined."):(Jumper.Options.ajax=!0,Jumper.Options.ajaxserver=options.ajaxserver),"undefined"==typeof jQuery)return void console.error("QOX Jumper requires jQuery.");if("undefined"==typeof $().selectize)return void console.error("QOX Jumper requires Selectize.js (https://github.com/brianreavis/selectize.js).");if("function"==typeof $().emulateTransitionEnd){if("undefined"==typeof BootstrapDialog)return void console.error("QOX Jumper for Bootstrap requires Bootstrap-Dialog (https://github.com/nakupanda/bootstrap3-dialog).");Jumper.Bootstrap3=!0}Jumper.Options.bindLetter=options.bindLetter.toLowerCase(),Jumper.Options.cacheAtInit=!0,$(window).bind("keydown",function(event){if(eval(Jumper.Options.bindFnKeys))switch(String.fromCharCode(event.which).toLowerCase()){case Jumper.Options.bindLetter:event.preventDefault(),Jumper.Open()}});var showKeys="CONTROL/COMMAND";Jumper.Options.bindFnKeys!=Jumper.KeysControl&&(showKeys=Jumper.Options.bindFnKeys),console.log("QOX Jumper: Initialized. (Open with: "+showKeys+" + "+Jumper.Options.bindLetter.toUpperCase()+")"),Jumper.Options.ajax&&Jumper.Cache&&Jumper.Options.cacheAtInit&&(console.log("QOX Jumper: PreCaching results @ Init..."),$.post(Jumper.Options.ajaxserver,{jumper_version:Jumper.VERSION},function(e){Jumper.Options.data=e.response,Jumper.InCache=!0,console.log("QOX Jumper: PreCaching results...DONE")},"json")),Jumper.Initialized=!0};Jumper.VERSION="0.0.0.3",Jumper.KeysControl="event.ctrlKey || event.metaKey",Jumper.Initialized=!1,Jumper.Bootstrap3=!1,Jumper.Options={},Jumper.BSD_Object=null,Jumper.Cache=!1,Jumper.InCache=!1,Jumper.TEXT_Loading="Loading data, please wait...",Jumper.TEXT_DefaultTitle="<b>Jumper</b>",Jumper.TEXT_QuickNav="Quick site navigation, type a term.",Jumper.TEXT_Navigating="Navigating...",Jumper.TEXT_Keywords="Keywords:",Jumper.BSD_Open=!1,Jumper.BSD_AjaxLoader={},Jumper.UpdateBSD=function(e){if("undefined"==typeof e||!e){var t='<input class="selectize-input items not-full has-options" id="jumper_text" style="width:100%" type="text" autocomplete="off" placeholder="'+Jumper.TEXT_QuickNav+'">';Jumper.BSD_Object.setMessage(t)}var o=$("#jumper_text");o.focus(),o.removeClass("selectize-input items not-full has-options");var n=o.selectize({persist:!1,maxItems:1,valueField:"name",labelField:"name",searchField:["name","help","keywords","navcode"],options:Jumper.Options.data,render:{item:function(e,t){return $("#jumper_text").attr("disabled","disabled"),window.location=e.url,setTimeout(function(){Jumper.BSD_Object.close()},250),'<div style="color: #000">'+t(Jumper.TEXT_Navigating)+"</span></div>"},option:function(e,t){var o=e.name,n=e.help;return'<div style="color: #000"><span style="font-width:bold;">'+t(o)+'</span><br><span class="text-muted">'+t(n)+"</span><br>"+(e.keywords?'<span style="color: #000;">'+Jumper.TEXT_Keywords+'</span>&nbsp;<span class="text-muted">'+t(e.keywords)+"</span>":"")+"</div>"}},load:function(e,t){return e.length?void 0:t()}}),r=n[0].selectize;setTimeout(function(){r.focus()},50)},Jumper.Open=function(){if(Jumper.Initialized)if(Jumper.Bootstrap3){if(!Jumper.BSD_Open){var e={title:Jumper.TEXT_DefaultTitle,draggable:!1,closable:!0,closeByBackdrop:!0,closeByKeyboard:!0,onhide:function(){Jumper.BSD_Open=!1},onhidden:function(){Jumper.BSD_Open=!1},onshow:function(){Jumper.BSD_Open=!0,$(".modal-footer").remove()}};Jumper.Options.ajax&&!Jumper.InCache?(e.message='<div style="text-align: center;"><p><i class="fa fa-refresh fa-spin"></i><br>'+Jumper.TEXT_Loading+"</p></div>",e.onshown=function(){console.log("QOX Jumper: Getting data."),$.post(Jumper.Options.ajaxserver,{jumper_version:Jumper.VERSION},function(e){Jumper.Options.data=e.response,Jumper.Cache&&(Jumper.InCache=!0),Jumper.UpdateBSD()},"json")}):(Jumper.Cache&&console.log("QOX Jumper: Using Cached data."),e.message='<input class="selectize-input items not-full has-options" style="width:100%" id="jumper_text" type="text" autocomplete="off" placeholder="'+Jumper.TEXT_QuickNav+'">',e.onshown=function(){Jumper.UpdateBSD(!0)}),Jumper.BSD_Object=BootstrapDialog.show(e)}}else console.error("Support for non-bootstrap sites in the future. Sorry.")};